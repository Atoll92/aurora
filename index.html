<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display a globe on a webpage</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
 
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoiZGdjb2Jvc3MiLCJhIjoiY2xzY2JnajIzMGZsNzJpcGM4b3l5OWttaCJ9.1GzkF8EERgQ5u1jkmP3C7w';
const map = new mapboxgl.Map({
container: 'map',
// style: 'mapbox://styles/mapbox/satellite-streets-v11',
style: 'mapbox://styles/mapbox/satellite-v9',
zoom: 1.5,
center: [0, 0],
projection: 'globe'
});

map.on('load', async () => {
  const response = await fetch('https://services.swpc.noaa.gov/json/ovation_aurora_latest.json');
  const forecastData = await response.json();
  map.setFog({});
  
  // Add a custom layer for the markers with altitude
  map.addLayer({
    id: 'aurora-markers',
    type: 'circle',
    source: {
      type: 'geojson',
      data: {
        type: 'FeatureCollection',
        features: forecastData.coordinates.map(coordinate => ({
          type: 'Feature',
          properties: {
            intensity: coordinate[2] // Adding intensity property to each feature
          },
          geometry: {
            type: 'Point',
            coordinates: [coordinate[0], coordinate[1], 400000]
          }
        }))
      }
    },
    
    paint: {
      'circle-radius': [
        'match',
        ['get', 'intensity'],
        1, 1,
        2, 2,
        3, 3,
        1 // Default radius
      ],
      'circle-color': [
        'match',
        ['get', 'intensity'],
        1, 'blue',
        2, 'red',
        [3,4], 'green',
        'blue' // Default color
      ],
      'circle-opacity': 0.5 // Set opacity to 0.5
    }
  });

  // Generate random lines from green circles
  forecastData.coordinates.forEach(coordinate => {
    const [longitude, latitude, intensity] = coordinate;
    
    if (intensity > 2) { // For green circles only
      const lineCoordinates = [];
      const numLines = Math.floor(Math.random() * 5) + 1; // Random number of lines (1 to 5)
      
      for (let i = 0; i < numLines; i++) {
        const randomAltitude = Math.floor(Math.random() * 590000) + 10000; // Random altitude between 10km and 600km
        lineCoordinates.push([
          longitude,
          latitude,
          randomAltitude
        ]);
      }
      
      map.addLayer({
        id: 'aurora-lines-' + longitude + '-' + latitude,
        type: 'line',
        source: {
          type: 'geojson',
          data: {
            type: 'Feature',
            properties: {},
            geometry: {
              type: 'LineString',
              coordinates: lineCoordinates
            }
          }
        },
        layout: {
          'line-join': 'round',
          'line-cap': 'round'
        },
        paint: {
          'line-color': 'green',
          'line-width': 1
        }
      });
    }
  });
});
</script>
 
</body>
</html>
